<div class="d-flex flex-wrap w-100" id="task-detail">
  <div class="col-md-3 ml-auto h-100" style="margin-top: 1.25rem">
    <mdb-card>

      <!--Card content-->
      <mdb-card-body>

        <!--Title-->
        <h4 class="text-center font-weight-bold">Danh sách công việc</h4>
        <h6 class="text-center">Nhân viên:
          <span class="text-primary" style="cursor: pointer; font-size: 18px; font-weight: 500"
            [routerLink]="['/employee-detail', task.assignee.id]">
            {{ task.assignee.name }}
          </span>
        </h6>
        <hr>
        <div class="col text-center">
          <owl-form-field class="w-100 px-3">
            <input owlInput class="text-center" [(ngModel)]="searchDateRange" [selectMode]="'range'"
              [owlDateTimeTrigger]="datepicker" [owlDateTime]="datepicker" placeholder="Thời gian công việc"
              (dateTimeChange)="getTaskByDate($event)">
            <owl-date-time #datepicker [pickerType]="'calendar'"></owl-date-time>
          </owl-form-field>
        </div>
        <!--Text-->
        <h5 class="text-center mt-3 font-weight-bold" *ngIf="taskList?.length !== 0">Công việc trong ngày</h5>
        <ul class="list-group list-group-flush pt-3">
          <a *ngFor="let task of taskList; let i = index" mdbWavesEffect
            class="list-group-item list-group-item-action waves-light"
            [ngClass]="{'list-group-item-action': task.id !== selectingId, 'active': (task.id === selectingId)}"
            (click)="loadTask(task.id)">
            {{task.title}} lúc {{task.startTime | date: 'HH:mm'}}
            <br>
            <small>Tại {{task.workplaceName}} - {{task.companyDTO.name}}</small>
          </a>
          <div *ngIf="taskListResponse?.numberOfElements === 0" class="text-center">
            <span class="text-danger">Không có công việc trong ngày</span>
          </div>
          <app-pagination *ngIf="taskListResponse?.totalPages > 1" [pageSize]="taskListResponse.size"
            [totalPage]="taskListResponse.totalPages" [currentPage]="taskListResponse.number"
            (changePage)="changePage1($event)">
          </app-pagination>
        </ul>

      </mdb-card-body>

    </mdb-card>
  </div>
  <div class="card card-cascade narrower mb-3 col-md-8 mr-auto waves-light h-100">
    <div class="p-3 row">

      <div class="col-md-7 col-12">

        <div class="d-flex flex-wrap">
          <div class="col-12 mt-3">

            <p class="h5 pl-0" *ngIf="task.status !== 0">Tên công việc:
              {{task.title}}
            </p>

            <div class="md-form my-0" *ngIf="task.status === 0">
              <input mdbInput type="text" class="form-control" [ngModel]="task.title" (ngModelChange)="updateTitle()">
              <label>Tên công việc</label>
            </div>

          </div>

          <div class="col-12 mt-2">
            <p class="h6 pl-0 font-weight-normal" *ngIf="task.status !== 0">Miêu tả công việc: {{task.description}}
            </p>


            <div class="md-form my-0" *ngIf="task.status === 0">
              <input mdbInput type="text" class="form-control" [(ngModel)]="task.description"
                (blur)="updateDescription()">
              <label>Miêu tả công việc</label>
            </div>

          </div>
        </div>

        <div class="col-md-12 mt-3">
          <h5 class="text-center font-weight-bold">
            Công việc phải làm
            <!-- <a mdbBtn floating="true" size="sm" color="primary" mdbWavesEffect>
              <i class="fa fa-pencil" (click)="openEditModal()"></i>
            </a> -->
            <a *ngIf="task.status === 0" mdbBtn floating="true" size="sm" color="success" mdbWavesEffect>
              <i class="fa fa-plus" (click)="openEditModal()"></i>
            </a>
            <a *ngIf="canRemove && task.status === 0" mdbBtn floating="true" size="sm" color="danger" mdbWavesEffect>
              <i class="fa fa-trash" (click)="removeTaskBasic()"></i>
            </a>
          </h5>
          <!-- <div style="overflow-y: scroll; height: 160px" > -->
          <div class="d-flex flex-wrap w-100" *ngIf="task.status === 0">
            <div class="col-6" *ngFor="let ck of task.checkList">
              <mdb-checkbox [inline]="true" (change)="changeCheckbox(ck.id, $event)">{{ck.title}}</mdb-checkbox>
            </div>
          </div>
          <div class="d-flex flex-wrap w-100" *ngIf="task.status !== 0">
            <div class="col-6" *ngFor="let ck of taskBasicList">
              <mdb-checkbox [disabled]="true" [inline]="true" [checked]="ck.status === 1">{{ck.title}}
              </mdb-checkbox>
            </div>
          </div>
        </div>
        <div class="col-md-12 mt-3" *ngIf="task.status !== 0 && task.status !== 1">
          <h5 class="text-center font-weight-bold">Báo cáo công việc
            <a *ngIf="task.status !== 0 && task.status !== 1 && report.length === 0" mdbBtn floating="true" size="sm"
              color="success" mdbWavesEffect>
              <i class="fa fa-plus" (click)="openReportModal()"></i>
            </a>
          </h5>
          <mdb-accordion [multiple]="false" aria-multiselectable="true">
            <mdb-accordion-item [collapsed]="true" *ngFor="let item of report">
              <mdb-accordion-item-head>
                <div [ngClass]="item.type === 1 ? 'text-success' : 'text-danger'">
                  Báo cáo lúc {{ item.dateReport | date: 'HH:mm' }}
                  <br>
                  <small>Nội dung: {{ item.description }}</small>
                </div>
              </mdb-accordion-item-head>
              <mdb-accordion-item-body>
                <p class="h6 mt-4">Hình ảnh</p>
                <p class="text-danger" *ngIf="item?.pictures.length === 0">Không có hình ảnh</p>
                <div class="col-md-12" *ngIf="item?.pictures.length > 0">
                  <mdb-image-modal [modalImages]="item.pictures" type="margin"></mdb-image-modal>
                </div>
                <div class="md-form" *ngIf="item.type !== 1">
                  <input mdbInput type="text" name="text" [disabled]="item.evaluated" [(ngModel)]="item.evaluation" id="form5" class="form-control">
                  <label for="form5" class="">Giải quyết vấn đề</label>
                </div>
                <hr *ngIf="item.type === 1">
                <h6 class="pt-3 font-weight-bold" *ngIf="item.type === 1">Đánh giá mức độ công việc</h6>
                <owl-rating class="justify-content-center w-100" style="font-size: 25px" *ngIf="item.type === 1"
                  [(ngModel)]="task.rating" [disabled]="item.evaluated">
                  <owl-rating-button value="1">
                    1 Star
                  </owl-rating-button>
                  <owl-rating-button value="2">
                    2 Stars
                  </owl-rating-button>
                  <owl-rating-button value="3">
                    3 Stars
                  </owl-rating-button>
                  <owl-rating-button value="4">
                    4 Stars
                  </owl-rating-button>
                  <owl-rating-button value="5">
                    5 Stars
                  </owl-rating-button>
                </owl-rating>
                <div class="md-form" *ngIf="item.type === 1">
                  <input mdbInput type="text" name="text" [disabled]="item.evaluated" [(ngModel)]="item.evaluation" id="form5" class="form-control">
                  <label for="form5" class="">Đánh giá chi tiết</label>
                </div>
                <div class="d-flex flex-wrap w-100 justify-content-center">
                  <button *ngIf="item.type !== 1 && !item.evaluated" mdbBtn rounded="true" type="button" color="primary"
                    mdbWavesEffect (click)="approve(item, 0)">Giải quyết</button>
                  <button *ngIf="item.type === 1 && !item.evaluated" mdbBtn rounded="true" type="button" color="success"
                    mdbWavesEffect (click)="approve(item, 1)">Duyệt</button>
                </div>
              </mdb-accordion-item-body>
            </mdb-accordion-item>
          </mdb-accordion>
        </div>
        <br>
        <!-- <button *ngIf="!isUpdate" class="btn-edit" mdbBtn type="button" color="primary" rounded="true" mdbWavesEffect
          (click)="isUpdate = true">Chỉnh sửa</button> -->
        <!-- <button *ngIf="task.status === 0" class="btn-delete" mdbBtn type="button" color="danger" rounded="true"
          mdbWavesEffect (click)="openDeleteModal()">
          <i class="fa fa-exclamation-triangle mr-2"></i>
          Xoá công việc
        </button> -->

      </div>

      <div class="col-md-5 col-12">
        <div class="md-form ">
          <h6 class="font-weight-bold d-flex flex-wrap">
            <span class="col-6 px-0 mr-auto">Trạng thái</span>
            <div class="col-6 px-0 ml-auto text-right">
              <a mdbBtn floating="true" size="sm" color="primary" class="btn-history" mdbWavesEffect>
                <i class="fa fa-history" (click)="history.show()"></i>
              </a>
            </div>
          </h6>
          <span *ngIf="task.status === 0" style="font-size: 15px" class="badge badge-light">Chưa bắt đầu</span>
          <span *ngIf="task.status === 1" style="font-size: 15px" class="badge badge-primary">Đang thực
            hiện</span>
          <span *ngIf="task.status === 2" style="font-size: 15px" class="badge badge-success">Hoàn thành</span>
          <span *ngIf="task.status === 3" style="font-size: 15px" class="badge badge-danger">Quá hạn</span>
          <span *ngIf="task.status === 4" style="font-size: 15px" class="badge badge-warning">Đang chờ duyệt</span>
          <!-- <mdb-select *ngIf="task.status === 4" [options]="iconStatusSelect" [(ngModel)]="task.status"
            placeholder="Duyệt" (selected)="changeStatus()" class="select-wrapper mdb-select md-form">
          </mdb-select> -->
        </div>

        <div class="md-form">
          <h6 class="font-weight-bold">Điểm danh</h6>
          <span *ngIf="task.attendanceStatus === 0" style="font-size: 15px" class="badge badge-light">Chưa điểm
            danh</span>
          <span *ngIf="task.attendanceStatus === 1" style="font-size: 15px" class="badge badge-success">Đúng
            giờ</span>
          <span *ngIf="task.attendanceStatus === 2" style="font-size: 15px" class="badge badge-warning">Trễ</span>
          <span *ngIf="task.attendanceStatus === 3" style="font-size: 15px" class="badge badge-danger">Vắng
            mặt</span>
        </div>

        <div class="md-form ">
          <p class="h6 mt-3">Người thực hiện: {{task.assignee.name}}</p>
          <!-- <span *ngIf="task.status !== 0" class="mx-3">{{task.assignee.name}}</span> -->
          <mdb-select [label]="'Người thực hiện khác'" *ngIf="task.status === 0" [options]="employeeList"
            [filterEnabled]="true" [(ngModel)]="assignTask.assigneeId" (selected)="openAssignModal()">
          </mdb-select>
        </div>

        <div class="md-form ">
          <p class="h6 mt-3">Nơi làm việc: {{task.workplace.name}}</p>
          <!-- <span class="mx-3" *ngIf="task.status !== 0">{{task.workplace.name}}</span> -->
          <mdb-select [label]="'Nơi làm việc khác'" *ngIf="task.status === 0" [options]="workplaceListByManager"
            [filterEnabled]="true" [(ngModel)]="manageWorkplace.workplaceId" (selected)="changeWorkplace($event)">
          </mdb-select>
        </div>

        <div class="md-form ">
          <p class="h6 mt-3 mb-4">Thời gian</p>
          <div class="col-12 mx-0" *ngIf="task.status !== 0">Từ:
            <span>{{task.startTime | date: 'HH:mm dd-MM-yyyy'}}</span></div>
          <div class="col-12 mx-0" *ngIf="task.status !== 0">Đến:
            <span>{{task.endTime | date: 'HH:mm dd-MM-yyyy'}}</span></div>
          <div class="row" *ngIf="task.status === 0">
            <!-- <app-date-picker ngDefaultControl [mode]="'range'" [(ngModel)]="dateRange"></app-date-picker> -->
            <owl-form-field class="w-100 px-3 text-center">
              <input owlInput [min]="minDate" [(ngModel)]="dateRange" [selectMode]="'range'"
                [owlDateTimeTrigger]="datepicker" [owlDateTime]="datepicker" (dateTimeChange)="changeStartTime($event)">
              <owl-date-time #datepicker></owl-date-time>
            </owl-form-field>
          </div>
        </div>
      </div>
      <!-- <button *ngIf="isUpdate" class="btn-confirm" mdbBtn type="button" color="success" rounded="true"
        mdbWavesEffect (click)="updateTask()">Xác nhận</button>
      <button *ngIf="isUpdate" class="btn-close" mdbBtn type="button" color="light" rounded="true" mdbWavesEffect
        (click)="isUpdate = false">Hủy</button> -->
    </div>
  </div>
</div>

<div mdbModal #delete="mdbModal" class="modal fade top" id="frameModalTop" tabindex="-1" role="dialog"
  aria-labelledby="delete" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-notify modal-danger" role="document">
    <!--Content-->
    <div class="modal-content text-center">
      <!--Header-->
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Xóa công việc này?</p>
      </div>

      <!--Body-->
      <div class="modal-body">
        <i class="fa fa-times fa-4x animated rotateIn"></i>
      </div>

      <!--Footer-->
      <div class="modal-footer flex-center">
        <a mdbBtn color="danger" outline="true" class="waves-effect" mdbWavesEffect (click)="removeTask()">Đồng ý</a>
        <a type="button" mdbBtn color="danger" class="waves-effect" mdbWavesEffect data-dismiss="modal"
          (click)="delete.hide()">Hủy</a>
      </div>
    </div>
    <!--/.Content-->
  </div>
</div>

<div mdbModal #assignModal="mdbModal" class="modal fade left" id="frameModalTop" tabindex="-1" role="dialog"
  aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-notify modal-primary" role="document">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Bàn giao công việc</p>
      </div>
      <div class="modal-body mx-3">

        <div class="md-form mb-4">
          <!-- <i class="fa fa-comments prefix grey-text"></i> -->
          <input type="text" id="description1" class="form-control" mdbInput [(ngModel)]="assignTask.description">
          <label for="description1">Lý do</label>
        </div>

      </div>
      <div class="modal-footer flex-center">
        <a mdbBtn color="primary" outline="true" class="waves-effect" mdbWavesEffect (click)="assign()">Đồng ý</a>
        <a type="button" mdbBtn color="primary" class="waves-effect" mdbWavesEffect data-dismiss="modal"
          (click)="assignModal.hide()">Hủy</a>
      </div>
    </div>
  </div>
</div>

<div mdbModal id="create" #create="mdbModal" class="modal fade left" tabindex="-1" role="dialog" aria-labelledby="add"
  aria-hidden="true">
  <div class="modal-dialog modal-notify modal-success" role="document">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Tạo công việc</p>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="create.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3 row">

        <div class="md-form mt-0 mb-3 col-6 col-md-12">
          <input type="text" id="title" class="form-control" mdbInput [(ngModel)]="taskBasicCM.title">
          <label for="title">Tên công việc</label>
        </div>

        <div class="file-field md-form col-12 pl-0 mt-0 mb-3">
          <div mdbBtn floating="true" size="md" color="blue" mdbWavesEffect>
            <i class="fa fa-cloud-upload" aria-hidden="true"></i>
            <input type="file" accept="image/*" (change)="onSelectFile($event)" mdbFileSelect
              (uploadOutput)="onUploadOutput($event)" [uploadInput]="uploadInput">
          </div>
          <div class="file-path-wrapper mt-3">
            <input class="file-path" type="text" placeholder="Chọn ảnh" [value]="showFiles()">
          </div>
        </div>

        <div class="col text-center" *ngIf="url">
          <img [src]="url" height="100">
        </div>

      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button mdbBtn color="success" class="waves-light" mdbWavesEffect (click)="createTaskBasic()">Tạo
          mới
          <i class="fa fa-check ml-1"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<div mdbModal id="edit" #edit="mdbModal" class="modal fade left" tabindex="-1" role="dialog" aria-labelledby="add"
  aria-hidden="true">
  <div class="modal-dialog modal-notify modal-primary" role="document">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Thêm danh sách công việc phải làm</p>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="edit.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3 row">

        <p class="h6">Danh sách công việc gợi ý</p>

        <div class="d-flex flex-wrap w-100">
          <div *ngFor="let t of taskBasicManagerList; let i of index" class="col-6">
            <mdb-checkbox name="item-{{i}}" #checkbox (change)="changeCheckboxCreateModal(t.id, $event)">{{t.title}}
            </mdb-checkbox>
          </div>
        </div>

      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button mdbBtn color="primary" class="waves-light" mdbWavesEffect (click)="addTaskBasicToTask()">Thêm vào danh
          sách
          <i class="fa fa-check ml-1"></i>
        </button>
        <button mdbBtn color="success" class="waves-light" mdbWavesEffect (click)="openCreateModal(); edit.hide()">Tạo
          mới
          <i class="fa fa-plus mr-1"></i>
        </button>
      </div>
    </div>
  </div>
</div>

<div mdbModal id="history" #history="mdbModal" class="modal fade left" tabindex="-1" role="dialog" aria-labelledby="add"
  aria-hidden="true">
  <div class="modal-dialog modal-notify modal-primary" role="document">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Lịch sử bàn giao</p>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="history.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3 row">

        <div *ngFor="let el of historyAssign; let i = index">

          <h6 class="font-weight-bold">
            {{i+1}}. Lúc {{ el.dateAssign | date: 'HH:mm' }} ngày {{ el.dateAssign | date: 'dd-MM-yyyy' }}
          </h6>

          <p>Giao cho {{el.assignee.name}}</p>

          <p *ngIf="!el.description">Không có miêu tả</p>
          <p *ngIf="el.description">Nguyên nhân: {{ el.description }}</p>

        </div>

      </div>
    </div>
  </div>
</div>

<div mdbModal id="reportModal" #reportModal="mdbModal" class="modal fade left" tabindex="-1" role="dialog"
  aria-labelledby="add" aria-hidden="true">
  <div class="modal-dialog modal-notify modal-success" role="document">
    <div class="modal-content">
      <div class="modal-header d-flex justify-content-center">
        <p class="heading">Tạo báo cáo</p>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" (click)="reportModal.hide()">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3 row">

        <div class="md-form mt-0 mb-3 col-6 col-md-12">
          <input type="text" id="title" class="form-control" mdbInput [(ngModel)]="managerReport.description">
          <label for="title">Nội dung báo cáo</label>
        </div>

      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button mdbBtn color="success" class="waves-light" mdbWavesEffect (click)="createReport()">Tạo
          <i class="fa fa-check ml-1"></i>
        </button>
      </div>
    </div>
  </div>
</div>